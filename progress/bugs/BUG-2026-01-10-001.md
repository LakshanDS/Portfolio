# BUG-2026-01-10-001: Resume API Route Type Mismatch

**Bug ID**: BUG-2026-01-10-001
**Severity**: Critical (Build Blocking)
**Status**: Open
**Date Reported**: 2026-01-10
**Priority**: High

---

## Summary

The Resume API route passes projects data with `tags: string` (from Prisma) to `ResumeDocument` component which expects `tags: string[]`, causing TypeScript compilation error.

---

## Location

**File**: [src/app/api/download-resume/route.tsx](file:///d:/Projects/Portfolio/src/app/api/download-resume/route.tsx)
**Line**: 67-76
**Function**: `GET` handler

---

## Error Message

```
Type '{ id: string; title: string; description: string; category: string; tags: string; status: string; imageUrl: string | null; demoUrl: string | null; repoUrl: string | null; content: string | null; createdAt: Date; updatedAt: Date; }[]' is not assignable to type '{ id: string; title: string; description: string; category: string; tags: string[]; status: string; imageUrl: string | null; demoUrl: string | null; repoUrl: string | null; content: string | null; createdAt: Date; updatedAt: Date; }[]'.
  Types of property 'tags' are incompatible.
    Type 'string' is not assignable to type 'string[]'.
```

---

## Affected Code

```typescript
// Line 67-71 (current implementation):
const projects = await prisma.project.findMany({
  where: { status: 'live' },
  take: 5,
  orderBy: { createdAt: 'desc' }
});

// Line 76 (where error occurs):
<ResumeDocument
  projects={projects}  // ERROR: tags is string, expected string[]
  roadmapItems={roadmapItems}
  skills={skills}
  profile={profile}
/>
```

---

## Root Cause

1. Prisma stores `tags` field as `String` type in database
2. Data is stored as JSON string (e.g., `"[\"react\", \"nextjs\"]"`)
3. The data layer functions (like `getProjects()`) parse this JSON to convert to `string[]`
4. However, the Resume API route queries Prisma directly without using the data layer functions
5. Therefore, it receives raw string instead of parsed array

---

## Expected Behavior

Projects array passed to `ResumeDocument` should have `tags: string[]` type

---

## Actual Behavior

Projects array has `tags: string` type (JSON string)

---

## Proposed Fix

### Option 1: Use Data Layer Function (Recommended)
Replace direct Prisma query with `getProjects()` which already handles JSON parsing:

```typescript
// Import the function
import { getProjects, getRoadmapItems, getAllSkills, getProfile } from '@/lib/data';

// In the GET handler:
const projects = await getProjects();
const liveProjects = projects.filter(p => p.status === 'live').slice(0, 5);
```

### Option 2: Parse Tags Inline
Add JSON parsing after the query:

```typescript
const projects = await prisma.project.findMany({
  where: { status: 'live' },
  take: 5,
  orderBy: { createdAt: 'desc' }
}).then(projects =>
  projects.map(p => ({ ...p, tags: JSON.parse(p.tags) }))
);
```

---

## Impact

- **Build Status**: BLOCKED - Compilation fails
- **Production**: Cannot deploy
- **Development**: Cannot test resume generation

---

## Blocks

- Build process
- All subsequent development
- Production deployment

---

## Verification Steps

1. Apply fix
2. Run: `npx tsc --noEmit`
3. Verify no TypeScript errors in route.tsx
4. Test resume generation endpoint manually

---

## Related Issues

- BUG-2026-01-10-003 (Status/Category Type Narrowing)
- BUG-2026-01-10-002 (Field Name Inconsistencies)

---

## References

- [src/lib/data.ts](file:///d:/Projects/Portfolio/src/lib/data.ts) - Contains proper `getProjects()` implementation
- [prisma/schema.prisma](file:///d:/Projects/Portfolio/prisma/schema.prisma) - Database schema definition
- [src/components/resume/ResumeDocument.tsx](file:///d:/Projects/Portfolio/src/components/resume/ResumeDocument.tsx) - Component interface

---

**Assigned To**: Unassigned
**Estimated Fix Time**: 5-10 minutes
**Actual Fix Time**: TBD
